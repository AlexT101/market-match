import OpenAI from 'openai';

const openai = new OpenAI({
    apiKey: process.env.NEXT_PUBLIC_OPENAI_KEY!,
    dangerouslyAllowBrowser: true
});

export const runtime = 'edge';

export async function POST(message: string) {
    const chatCompletion = await openai.chat.completions.create({
        messages: [{ role: 'user', content: message }],
        model: 'gpt-3.5-turbo',
    });
    return chatCompletion;
}

export function getDataPoints(graph: any) {
    let dataPoints = [];
    for (let key in graph) {
        dataPoints.push({ date: key, Price: graph[key] });
    }
    return dataPoints;
}

export function getDataArray(graph: any) {
    let dataPoints = [];
    for (let key in graph) {
        dataPoints.push(graph[key]);
    }
    return dataPoints;
}

export function getBounds(data: any) {
    let smallest = data[0].Price;
    let biggest = data[0].Price;
    for (let key in data) {
        if (data[key].Price < smallest) {
            smallest = data[key].Price;
        }
        if (data[key].Price > biggest) {
            biggest = data[key].Price;
        }
    }
    return [smallest, biggest];
}

export async function getAmounts(size: number, risk: string) {
    let riskType = risk == "Low Risk (Conservative)" ? "low" : risk == "Medium Risk (Mix)" ? "medium" : "high";
    const response = await fetch("http://13.58.138.38:8000//RecommendedPortfolio/" + riskType);
    const data = await response.json();
    let result = [];
    for (let i = 0; i < size; i++) {
        result.push(1 / size);
    }
    return result;
}

const sampleStock = {
    "ticker": "MSI",
    "graph_data": {
        "six_month": {
            "2024-02-09": 330.89,
            "2024-02-08": 328.35,
            "2024-02-07": 327.93,
            "2024-02-06": 325.38,
            "2024-02-05": 325.3,
            "2024-02-02": 327.62,
            "2024-02-01": 325.15,
            "2024-01-31": 319.5,
            "2024-01-30": 327.52,
            "2024-01-29": 326.75,
            "2024-01-26": 326.1,
            "2024-01-25": 328.59,
            "2024-01-24": 328.35,
            "2024-01-23": 329.47,
            "2024-01-22": 324.99,
            "2024-01-19": 326.28,
            "2024-01-18": 320.97,
            "2024-01-17": 317.03,
            "2024-01-16": 315.65,
            "2024-01-12": 316.31,
            "2024-01-11": 314.28,
            "2024-01-10": 315.04,
            "2024-01-09": 312.01,
            "2024-01-08": 312.86,
            "2024-01-05": 309.16,
            "2024-01-04": 311.75,
            "2024-01-03": 312,
            "2024-01-02": 311.64,
            "2023-12-29": 313.09,
            "2023-12-28": 311.07,
            "2023-12-27": 310.42,
            "2023-12-26": 310,
            "2023-12-22": 309.85,
            "2023-12-21": 310.55,
            "2023-12-20": 309.39,
            "2023-12-19": 312.97,
            "2023-12-18": 314.96,
            "2023-12-15": 310.5,
            "2023-12-14": 315.82,
            "2023-12-13": 326.94,
            "2023-12-12": 328.96,
            "2023-12-11": 326.41,
            "2023-12-08": 324.52,
            "2023-12-07": 323.36,
            "2023-12-06": 322.47,
            "2023-12-05": 324.56,
            "2023-12-04": 323.66,
            "2023-12-01": 325.32,
            "2023-11-30": 322.87,
            "2023-11-29": 319.04,
            "2023-11-28": 318.46,
            "2023-11-27": 320.67,
            "2023-11-24": 320.84,
            "2023-11-22": 319.52,
            "2023-11-21": 319.99,
            "2023-11-20": 319.43,
            "2023-11-17": 318.25,
            "2023-11-16": 317.26,
            "2023-11-15": 314.12,
            "2023-11-14": 312.26,
            "2023-11-13": 309.64,
            "2023-11-10": 311.02,
            "2023-11-09": 308.8,
            "2023-11-08": 309.19,
            "2023-11-07": 304.98,
            "2023-11-06": 304.58,
            "2023-11-03": 299.42,
            "2023-11-02": 281.17,
            "2023-11-01": 280.5,
            "2023-10-31": 278.46,
            "2023-10-30": 276.22,
            "2023-10-27": 272.39,
            "2023-10-26": 274.84,
            "2023-10-25": 280.51,
            "2023-10-24": 281.44,
            "2023-10-23": 279.43,
            "2023-10-20": 281.25,
            "2023-10-19": 281.94,
            "2023-10-18": 288.22,
            "2023-10-17": 289.85,
            "2023-10-16": 293.32,
            "2023-10-13": 288.15,
            "2023-10-12": 288.28,
            "2023-10-11": 287.6,
            "2023-10-10": 285.05,
            "2023-10-09": 286.31,
            "2023-10-06": 276.14,
            "2023-10-05": 273.23,
            "2023-10-04": 274.23,
            "2023-10-03": 271.49,
            "2023-10-02": 272.92,
            "2023-09-29": 272.24,
            "2023-09-28": 274.19,
            "2023-09-27": 272.98,
            "2023-09-26": 273.5,
            "2023-09-25": 276.66,
            "2023-09-22": 277.74,
            "2023-09-21": 279.17,
            "2023-09-20": 285.74,
            "2023-09-19": 285.8,
            "2023-09-18": 287.4,
            "2023-09-15": 283.21,
            "2023-09-14": 284.83,
            "2023-09-13": 280.08,
            "2023-09-12": 281.3,
            "2023-09-11": 283.51,
            "2023-09-08": 282.5,
            "2023-09-07": 282.41,
            "2023-09-06": 280.92,
            "2023-09-05": 281.07,
            "2023-09-01": 283.68,
            "2023-08-31": 283.57,
            "2023-08-30": 283.19,
            "2023-08-29": 282.03,
            "2023-08-28": 280.88,
            "2023-08-25": 278.78,
            "2023-08-24": 275.6,
            "2023-08-23": 277.79,
            "2023-08-22": 275.89,
            "2023-08-21": 277.16,
            "2023-08-18": 277.68,
            "2023-08-17": 277.46,
            "2023-08-16": 281.64,
            "2023-08-15": 281.29,
            "2023-08-14": 285.04,
            "2023-08-11": 285.96
        },
        "one_month": {
            "2024-02-09": 330.89,
            "2024-02-08": 328.35,
            "2024-02-07": 327.93,
            "2024-02-06": 325.38,
            "2024-02-05": 325.3,
            "2024-02-02": 327.62,
            "2024-02-01": 325.15,
            "2024-01-31": 319.5,
            "2024-01-30": 327.52,
            "2024-01-29": 326.75,
            "2024-01-26": 326.1,
            "2024-01-25": 328.59,
            "2024-01-24": 328.35,
            "2024-01-23": 329.47,
            "2024-01-22": 324.99,
            "2024-01-19": 326.28,
            "2024-01-18": 320.97,
            "2024-01-17": 317.03,
            "2024-01-16": 315.65,
            "2024-01-12": 316.31,
            "2024-01-11": 314.28
        },
        "ytd": {
            "2024-02-09": 330.89,
            "2024-02-08": 328.35,
            "2024-02-07": 327.93,
            "2024-02-06": 325.38,
            "2024-02-05": 325.3,
            "2024-02-02": 327.62,
            "2024-02-01": 325.15,
            "2024-01-31": 319.5,
            "2024-01-30": 327.52,
            "2024-01-29": 326.75,
            "2024-01-26": 326.1,
            "2024-01-25": 328.59,
            "2024-01-24": 328.35,
            "2024-01-23": 329.47,
            "2024-01-22": 324.99,
            "2024-01-19": 326.28,
            "2024-01-18": 320.97,
            "2024-01-17": 317.03,
            "2024-01-16": 315.65,
            "2024-01-12": 316.31,
            "2024-01-11": 314.28,
            "2024-01-10": 315.04,
            "2024-01-09": 312.01,
            "2024-01-08": 312.86,
            "2024-01-05": 309.16,
            "2024-01-04": 311.75,
            "2024-01-03": 312,
            "2024-01-02": 311.64
        }
    },
    "intraday_data": {
        "09:30": 324.05,
        "09:31": 324.05,
        "09:32": 324.848,
        "09:33": 326.415,
        "09:34": 328.13,
        "09:35": 328.13,
        "09:36": 328.13,
        "09:37": 328.13,
        "09:38": 330.82,
        "09:39": 330.568,
        "09:40": 330.568,
        "09:41": 330.568,
        "09:42": 328.918,
        "09:43": 328.625,
        "09:44": 328.318,
        "09:45": 328.318,
        "09:46": 328.318,
        "09:47": 328.318,
        "09:48": 328.318,
        "09:49": 328.318,
        "09:50": 328.318,
        "09:51": 328.318,
        "09:52": 327.803,
        "09:53": 327.803,
        "09:54": 327.803,
        "09:55": 329.245,
        "09:56": 329.245,
        "09:57": 329.245,
        "09:58": 332.237,
        "09:59": 332.237,
        "10:00": 332.237,
        "10:01": 332.237,
        "10:02": 332.237,
        "10:03": 330.208,
        "10:04": 330.25,
        "10:05": 329.73,
        "10:06": 329.73,
        "10:07": 329.593,
        "10:08": 329.645,
        "10:09": 329.32,
        "10:10": 328.925,
        "10:11": 329.885,
        "10:12": 329.885,
        "10:13": 329.885,
        "10:14": 329.885,
        "10:15": 329.885,
        "10:16": 329.833,
        "10:17": 329.833,
        "10:18": 329.833,
        "10:19": 329.875,
        "10:20": 329.875,
        "10:21": 329.875,
        "10:22": 329.26,
        "10:23": 329.8,
        "10:24": 330.41,
        "10:25": 330.41,
        "10:26": 329.76,
        "10:27": 329.76,
        "10:28": 329.76,
        "10:29": 329.76,
        "10:30": 330.175,
        "10:31": 330.185,
        "10:32": 330.185,
        "10:33": 329.885,
        "10:34": 329.885,
        "10:35": 329.885,
        "10:36": 330.105,
        "10:37": 330.105,
        "10:38": 330.105,
        "10:39": 330.105,
        "10:40": 330.105,
        "10:41": 330.105,
        "10:42": 329.93,
        "10:43": 329.93,
        "10:44": 329.93,
        "10:45": 329.095,
        "10:46": 329.095,
        "10:47": 329.095,
        "10:48": 329.095,
        "10:49": 329.095,
        "10:50": 328.945,
        "10:51": 328.945,
        "10:52": 329.178,
        "10:53": 329.085,
        "10:54": 328.755,
        "10:55": 328.755,
        "10:56": 328.58,
        "10:57": 328.58,
        "10:58": 328.05,
        "10:59": 328.02,
        "11:00": 328.02,
        "11:01": 329.22,
        "11:02": 329.22,
        "11:03": 329.22,
        "11:04": 329.22,
        "11:05": 328.25,
        "11:06": 328.25,
        "11:07": 328.25,
        "11:08": 328.25,
        "11:09": 328.25,
        "11:10": 328.25,
        "11:11": 327.99,
        "11:12": 327.99,
        "11:13": 327.99,
        "11:14": 327.99,
        "11:15": 327.99,
        "11:16": 328.675,
        "11:17": 328.675,
        "11:18": 328.675,
        "11:19": 328.675,
        "11:20": 328.675,
        "11:21": 328.675,
        "11:22": 328.675,
        "11:23": 328.675,
        "11:24": 328.675,
        "11:25": 329.175,
        "11:26": 329.175,
        "11:27": 329.175,
        "11:28": 329.175,
        "11:29": 329.175,
        "11:30": 329.175,
        "11:31": 329.175,
        "11:32": 329.175,
        "11:33": 329.175,
        "11:34": 327.67,
        "11:35": 327.67,
        "11:36": 326.28,
        "11:37": 326.28,
        "11:38": 326.28,
        "11:39": 326.155,
        "11:40": 326.2,
        "11:41": 326.2,
        "11:42": 326.2,
        "11:43": 326.2,
        "11:44": 326.2,
        "11:45": 325.595,
        "11:46": 325.595,
        "11:47": 325.595,
        "11:48": 325.595,
        "11:49": 325.76,
        "11:50": 325.76,
        "11:51": 325.555,
        "11:52": 325.555,
        "11:53": 325.555,
        "11:54": 325.555,
        "11:55": 325.555,
        "11:56": 325.555,
        "11:57": 325.555,
        "11:58": 325.555,
        "11:59": 325.555,
        "12:00": 325.555,
        "12:01": 325.555,
        "12:02": 325.555,
        "12:03": 325.555,
        "12:04": 325.555,
        "12:05": 325.555,
        "12:06": 325.555,
        "12:07": 325.555,
        "12:08": 325.555,
        "12:09": 324.5,
        "12:10": 324.5,
        "12:11": 324.5,
        "12:12": 324.5,
        "12:13": 324.5,
        "12:14": 324.5,
        "12:15": 324.5,
        "12:16": 324.305,
        "12:17": 324.305,
        "12:18": 324.305,
        "12:19": 324.583,
        "12:20": 324.583,
        "12:21": 324.583,
        "12:22": 324.583,
        "12:23": 324.583,
        "12:24": 324.475,
        "12:25": 324.475,
        "12:26": 323.69,
        "12:27": 323.675,
        "12:28": 323.675,
        "12:29": 323.675,
        "12:30": 323.72,
        "12:31": 323.72,
        "12:32": 323.72,
        "12:33": 323.72,
        "12:34": 323.72,
        "12:35": 323.72,
        "12:36": 323.72,
        "12:37": 323.72,
        "12:38": 323.72,
        "12:39": 323.72,
        "12:40": 323.285,
        "12:41": 323.47,
        "12:42": 324.35,
        "12:43": 324.273,
        "12:44": 324.273,
        "12:45": 324.273,
        "12:46": 324.273,
        "12:47": 324.273,
        "12:48": 324.933,
        "12:49": 324.933,
        "12:50": 324.933,
        "12:51": 324.638,
        "12:52": 324.638,
        "12:53": 324.638,
        "12:54": 324.18,
        "12:55": 323.82,
        "12:56": 323.82,
        "12:57": 323.82,
        "12:58": 323.82,
        "12:59": 323.82,
        "13:00": 323.82,
        "13:01": 323.82,
        "13:02": 323.82,
        "13:03": 323.82,
        "13:04": 323.82,
        "13:05": 323.82,
        "13:06": 323.82,
        "13:07": 323.82,
        "13:08": 323.82,
        "13:09": 323.82,
        "13:10": 323.82,
        "13:11": 324.715,
        "13:12": 324.715,
        "13:13": 324.715,
        "13:14": 324.715,
        "13:15": 324.715,
        "13:16": 324.715,
        "13:17": 324.715,
        "13:18": 324.715,
        "13:19": 324.715,
        "13:20": 324.715,
        "13:21": 324.715,
        "13:22": 324.715,
        "13:23": 324.715,
        "13:24": 324.715,
        "13:25": 326.548,
        "13:26": 326.548,
        "13:27": 326.548,
        "13:28": 326.548,
        "13:29": 325.505,
        "13:30": 325.505,
        "13:31": 325.505,
        "13:32": 325.505,
        "13:33": 325.505,
        "13:34": 325.505,
        "13:35": 325.505,
        "13:36": 325.505,
        "13:37": 325.335,
        "13:38": 325.335,
        "13:39": 325.335,
        "13:40": 325.335,
        "13:41": 325.335,
        "13:42": 325.335,
        "13:43": 325.335,
        "13:44": 325.335,
        "13:45": 325.335,
        "13:46": 325.335,
        "13:47": 325.335,
        "13:48": 325.335,
        "13:49": 326.465,
        "13:50": 326.465,
        "13:51": 326.465,
        "13:52": 326.465,
        "13:53": 326.465,
        "13:54": 326.465,
        "13:55": 326.465,
        "13:56": 326.465,
        "13:57": 326.465,
        "13:58": 327.508,
        "13:59": 327.46,
        "14:00": 327.46,
        "14:01": 327.935,
        "14:02": 327.655,
        "14:03": 327.655,
        "14:04": 327.655,
        "14:05": 327.655,
        "14:06": 327.655,
        "14:07": 327.655,
        "14:08": 327.655,
        "14:09": 327.655,
        "14:10": 327.655,
        "14:11": 327.655,
        "14:12": 327.655,
        "14:13": 327.655,
        "14:14": 328.46,
        "14:15": 328.46,
        "14:16": 328.46,
        "14:17": 328.46,
        "14:18": 328.46,
        "14:19": 328.46,
        "14:20": 328.46,
        "14:21": 328.3,
        "14:22": 328.3,
        "14:23": 328.3,
        "14:24": 328.3,
        "14:25": 328.3,
        "14:26": 328.3,
        "14:27": 328.3,
        "14:28": 328.625,
        "14:29": 328.625,
        "14:30": 328.625,
        "14:31": 328.625,
        "14:32": 328.875,
        "14:33": 328.875,
        "14:34": 328.875,
        "14:35": 329.118,
        "14:36": 329.118,
        "14:37": 329.225,
        "14:38": 329.225,
        "14:39": 329.225,
        "14:40": 329.225,
        "14:41": 329.59,
        "14:42": 329.59,
        "14:43": 329.8,
        "14:44": 329.8,
        "14:45": 329.8,
        "14:46": 329.8,
        "14:47": 329.565,
        "14:48": 329.565,
        "14:49": 329.17,
        "14:50": 329.17,
        "14:51": 329.17,
        "14:52": 329.17,
        "14:53": 329.83,
        "14:54": 329.83,
        "14:55": 329.83,
        "14:56": 329.89,
        "14:57": 329.89,
        "14:58": 329.89,
        "14:59": 330.31,
        "15:00": 330.307,
        "15:01": 330.17,
        "15:02": 330.17,
        "15:03": 330.17,
        "15:04": 330.17,
        "15:05": 330.17,
        "15:06": 330.17,
        "15:07": 330.17,
        "15:08": 330.17,
        "15:09": 330.17,
        "15:10": 330.17,
        "15:11": 330.17,
        "15:12": 330.17,
        "15:13": 330.17,
        "15:14": 330.17,
        "15:15": 330.17,
        "15:16": 330.17,
        "15:17": 330.17,
        "15:18": 330.17,
        "15:19": 329.595,
        "15:20": 329.93,
        "15:21": 329.89,
        "15:22": 329.89,
        "15:23": 330.52,
        "15:24": 330.52,
        "15:25": 330.04,
        "15:26": 330.04,
        "15:27": 329.735,
        "15:28": 329.735,
        "15:29": 329.51,
        "15:30": 329.51,
        "15:31": 329.51,
        "15:32": 329.51,
        "15:33": 329.51,
        "15:34": 329.51,
        "15:35": 329.51,
        "15:36": 328.66,
        "15:37": 328.33,
        "15:38": 328.648,
        "15:39": 328.905,
        "15:40": 328.905,
        "15:41": 328.905,
        "15:42": 328.905,
        "15:43": 328.905,
        "15:44": 328.905,
        "15:45": 328.52,
        "15:46": 328.44,
        "15:47": 328.55,
        "15:48": 328.55,
        "15:49": 328.55,
        "15:50": 328.56,
        "15:51": 328.645,
        "15:52": 328.99,
        "15:53": 328.99,
        "15:54": 328.99,
        "15:55": 329.198,
        "15:56": 330.095,
        "15:57": 329.943,
        "15:58": 330.188,
        "15:59": 330.89,
        "16:00": 330.89
    },
    "marketcap_data": 54927740000,
    "pe_data": 33.49,
    "consolidatedvolume_data": 1203365,
    "marketOpen_data": 323.82,
    "previousClose_data": 328.35,
    "name_data": "Motorola Solutions Inc",
    "size_data": 19521,
    "sector_data": "Manufacturing",
    "description_data": "motorola solutions, inc. (www.motorolasolutions.com), provides mission-critical communications products and services to public safety and commercial customers around the world. our innovations, products, and services play essential roles in people's lives.\n we help firefighters see around buildings and police officers see around street corners.\n we provide the situational awareness first responders need when a moment brings catastrophe.\n we do this by connecting them to seamless communication networks, applications and services, by providing them with real-time information, and by arming them with intuitive, nearly indestructible handheld devices. motorola solutions helps people be their best in the moments that matter. learn more at www.motorolasolutions.com."
}

export async function getStock(ticker: string, swipe: boolean) {
    let append = "";
    if (ticker != null && ticker != "") {
        append = ticker + "/" + swipe;
    }
    const response = await fetch("http://13.58.138.38:8000/get_next_ticker/" + append);
    const data = await response.json();
    console.log(data);
    return data;
    //return sampleStock;
}

export async function sendPreferences(preferences: any) {
    let risk = preferences.risk == "Low Risk (Conservative)" ? 2 : preferences.risk == "Medium Risk (Mix)" ? 5 : 8;
    let sectors = "";
    for (let i = 0; i < preferences.sector.length; i++) {
        sectors += preferences.sector[i];
        if (i < preferences.sector.length - 1) {
            sectors += ",";
        }
    }
    const response = await fetch("http://13.58.138.38:8000/create_account/" + risk + "/" + sectors + "/" + preferences.age + "/" + preferences.size);

    console.log(preferences);
}

export async function getResponse(ticker:string, name: string, question: string) {
    const prompt = "You are going to provide helpful answers to questions a beginning stock investor might have. The ticker for the current company stock is " + ticker + " and the company name is " + name + ". Do not provide financial advice. Here is the question: "
    const response = await POST(prompt + question);
    return response.choices[0].message.content;
}

export async function parseStocks(stocks: any) {
    var newStockData = [];
    for (let i = 0; i < stocks.length; i++) {
        newStockData.push({
            name: stocks[i].name_data,
            ticker: stocks[i].ticker,
            swipe: stocks[i].swipe,
            time: stocks[i].time,
            price: stocks[i].marketOpen_data,
            graph: getDataArray(stocks[i].graph_data.six_month),
        })
    }
    return newStockData;
}